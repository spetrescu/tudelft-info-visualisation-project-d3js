<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <script type="text/javascript" nonce="a6f79910b59e4ca48a00da0cda5"
    src="//local.adguard.org?ts=1607701659773&amp;type=content-script&amp;dmn=bl.ocks.org&amp;app=com.apple.Safari&amp;css=1&amp;js=1&amp;gcss=1&amp;rel=1&amp;rji=1&amp;sbe=0"></script>
  <script type="text/javascript" nonce="a6f79910b59e4ca48a00da0cda5"
    src="//local.adguard.org?ts=1607701659773&amp;name=AdGuard%20Extra&amp;type=user-script"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>

  <script src="https://d3js.org/d3.v4.min.js">
  </script>
  <script src="https://d3js.org/d3-color.v1.min.js">
  </script>
  <script src="https://d3js.org/d3-interpolate.v1.min.js">
  </script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js">
  </script>

  <style type="text/css">
    body {
      /* This is the CSS for body */
      position: relative;
      min-width: 900px;
      /*overflow: hidden;  Overflow set to hidden. Any elements outside of the window will not be shown */
      height: 100%;
      /* Height set to 100% means the body will extend from the top of the window to the bottom */
      max-height: 100%;
      /* Maximum height is limited to 100% */
      font-family: 'Montserrat', sans-serif;
      /* Font used in body is Montserrat */
      line-height: 1.5em;
      /* Line spacing is set to 1.5em */
      font-size: 18px;
      /* Font size set to 18px */
    }

    main {
      top: 50px;
      bottom: 40px;
      left: 0;
      right: 0;
      overflow: auto;
      background: #EFEFEF;
      width: 100%;
      min-width: 900px;
    }

    input[type=range] {
      -webkit-appearance: none;
      width: 250px;
      height: 10px;
    }

    input[type=range]::-webkit-slider-runnable-track {
      width: 800px;
      height: 7px;
      background: #ddd;
      border: none;
      border-radius: 3px;
    }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      border: none;
      height: 20px;
      width: 20px;
      border-radius: 20%;
      background: rgb(255, 183, 1);
      margin-top: -6px;
    }

    input[type=range]:focus {
      outline: none;
    }

    input[type=range]:focus::-webkit-slider-runnable-track {
      background: #ccc;
    }

    /* #ccc; */
    input[type=range]:hover {
      opacity: .8;
    }

    /* Legend Font Style */
    body {
      font: 15px sans-serif;
      background-color: #ffffff;

    }

    div.tooltip {
      position: absolute;
      text-align: center;
      width: 60px;
      height: 28px;
      padding: 2px;
      font: 12px sans-serif;
      background: rgb(34, 19, 19);
      border: 0px;
      border-radius: 8px;
      pointer-events: none;
    }

    .d3-tip {
      line-height: 1;
      padding: 12px;
      background: rgba(43, 43, 43, 0.8);
      color: #fff;
      border-radius: 2px;
    }

    /* Legend Position Style */
    .legend {
      position: absolute;
      left: 20px;
      top: 30px;
    }

    .axis text {
      font: 10px sans-serif;
    }

    /* On mouse hover, lighten state color */
    path:hover {
      fill-opacity: .5;
    }

    .axis line,
    .axis path {
      fill: none;
      stroke: rgb(95, 95, 95);
      shape-rendering: crispEdges;
    }

    /*style for select dropdown */
    select {
      margin: 5px;
      width: 150px;
      padding: 5px 35px 5px 5px;
      font-size: 17px;
      border: 1px solid #CCC;
      height: 34px;
      /* -webkit-appearance: none;
  -moz-appearance: none; */
      appearance: none;
      /* background: url(https://stackoverflow.com/favicon.ico) 96% / 15% no-repeat #EEE; */
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>

</head>

<body style="background-color:#cccccc" onload="load()">
  <h1>Wildfires in USA in <span id="nRadius-value">1992</span> for <select id="selectButton">ALL CAUSES</select></h1>
  
  <div id="legend1" style="display: inline-block" position="absolute"></div>

  <div style="position: absolute" style="top: 80px">
    <input type="range" min="1992" max="2015" id="nRadius" step="1" value="1992"> <b><span
        id="nRadius-value2">1992</span></b>
  </div>



  <script type="text/javascript">

    //select menu for causes
    // List of groups (here I have one group per column)
    var allGroup = ["All causes", "Arson", "Campfires", "Smoking"]
    d3.select("#selectButton")
      .selectAll('myOptions')
      .data(allGroup)
      .enter()
      .append('option')
      .text(function (d) { return d; }) // text showed in the menu
      .attr("value", function (d) { return d; })

    //listen to change on select menu
    d3.select("#selectButton").on("change", function () {
      var selectedOption = d3.select(this).property("value")
      // run the updateChart function with this selected option
      
      //update(selectedOption)
      // adjust the text on the range slider
      //
      //
      titleYear = document.getElementById('nRadius-value2').innerHTML;
      console.log("TitleYear = " + titleYear)
      // d3.select("#nRadius-value").text(titleYear);
      // d3.select("#nRadius-value2").text(scrollYear);
      updateMap(titleYear, selectedOption);
      // d3.select("#nRadius").property("value", nRadius);
    });

    // when the input range changes update the circle 
    d3.select("#nRadius").on("input", function () {
      // adjust the text on the range slider
      d3.select("#nRadius-value").text(+this.value);
      d3.select("#nRadius-value2").text(+this.value);
      cause = d3.select("#selectButton").property("value");
      console.log("Value of cause: " + cause)
      updateMap(+this.value, cause);
      // d3.select("#nRadius").property("value", nRadius);
    });


    var yLegend = d3.scaleLinear()
      .domain([1, 11])
      .rangeRound([58, 300]);


    //Width and height of map
    var width = 960;
    var height = 500;

    var lowColor = '#f9f9f9'
    var highColor = '#bc2a66'

    // D3 Projection
    var projection = d3.geoAlbersUsa()
      .translate([width / 2, height / 2]) // translate to center of screen
      .scale([1000]); // scale things down so see entire US

    // Define path generator
    var path = d3.geoPath() // path generator that will convert GeoJSON to SVG paths
      .projection(projection); // tell path generator to use albersUsa projection

    //Create SVG element and append map to the SVG
    var svg = d3.select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", height);


    var color = d3.scaleThreshold()
      .domain(d3.range(2, 18))
      .range(d3.schemeYlOrRd[9]);

    var g = svg.append("g");
    /*The title of the d3 map*/
    svg.append("text")
      .attr("x", 400)
      .attr("y", 20)
      .attr("font-family", "sans-serif")
      .style("font-size", "20px")
      .style("font-weight", "bold")
      .text("");

    svg.append("input-range")
      .attr("x", 400)
      .attr("y", 20)
      .attr("font-family", "sans-serif")
      .style("font-size", "20px")
      .style("font-weight", "bold")
      .text("");



    var tip = d3.tip()
      .attr('class', 'd3-tip')
      .offset([-5, 0])
      .html(function (d) {
        var dataRow = countryById.get(d.properties.name);
        if (dataRow) {
          //console.log(dataRow);
          return dataRow.states + ": " + dataRow.value;
        } else {
          //console.log("no dataRow", d);
          return d.properties.name + ": " + d.properties.value;
        }
      })
    svg.call(tip);

    var countryById = d3.map();

    function typeAndSet(d) {
      d.value = +d.value;
      countryById.set(d.states, d);
      return d;
    }
    function getColor(d) {
      var dataRow = countryById.get(d.properties.name);
      if (dataRow) {
        //console.log(dataRow);
        return ramp(dataRow.value);
      } else {
        //console.log("no dataRow", d);
        return "#ccc";
      }
    }


    function updateMapAllCauses(fileNumber, cause) {
      console.log("Updating map for all causes ...")

      console.log("fileNumber is = " + fileNumber)
      console.log("cause is = " + cause)


      /*Build the vertical legend: create the rectangles, fill with the appropriate color scale*/
      g.selectAll("rect")
        .data(color.range().map(function (d) {
          d = color.invertExtent(d);
          if (d[0] == null) d[0] = yLegend.domain()[0];
          if (d[1] == null) d[1] = yLegend.domain()[1];
          return d;
        }))
        .enter().append("rect")
        .attr("height", 25)
        .attr("x", -50)
        .attr("y", function (d) {
          return yLegend(d[0]) + 12;
        })
        .attr("width", 33)
        .attr("fill", function (d) { return color(d[0]); })
        .attr("col", function (d) { return d[0] })
        .on('mouseover', function input() {
          d3.selectAll("rect")
            //.remove()
            .transition()
            .duration(200)
            .style("opacity", .7)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
        })
        .on('click', function (dis, i, n) {
          d3.selectAll("path").each(function (d) {
            //var a = d["properties"]['value']
            //console.log(d3.select(n[i]).attr("col"))
            var opcaityOnClick = 0.3
            if (d == null) {
              console.log("NK")
              console.log(" is = " + d3.select(n[i]).attr("y"))
            } else if (d["properties"]['value'] > 10000) {
              //d3.select(this).style("opacity", .5)
            }
            if (d3.select(n[i]).attr("y") == 70 && d != null) {
              if (d["properties"]['value'] > 1000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 94 && d != null) {
              if (d["properties"]['value'] < 1000 || d["properties"]['value'] > 2000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 118 && d != null) {
              if (d["properties"]['value'] < 2000 || d["properties"]['value'] > 3000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 143 && d != null) {
              if (d["properties"]['value'] < 3000 || d["properties"]['value'] > 4000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 167 && d != null) {
              if (d["properties"]['value'] < 4000 || d["properties"]['value'] > 5000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 191 && d != null) {
              if (d["properties"]['value'] < 5000 || d["properties"]['value'] > 6000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 215 && d != null) {
              if (d["properties"]['value'] < 6000 || d["properties"]['value'] > 7000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 239 && d != null) {
              if (d["properties"]['value'] < 7000 || d["properties"]['value'] > 8000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 264 && d != null) {
              if (d["properties"]['value'] < 10000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }

          });
          //style("stroke", "#f00").style("opacity", .1)
          //svg.selectAll('path[attr = "e: 0"]').remove()
          // .transition()
          // .duration(200)
          // .style("opacity", 1)
          d3.selectAll("rect")
            //.remove()
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", .5)
          //         d3.selectAll("path").each(function(d,i) {
          //   console.log("The x position of the rect #" + i + " is " + d3.select(this).attr("e"))
          // })
          // console.log()
          // d3.selectAll("path")
        })
        .on('mouseout', function input() {
          d3.selectAll("path")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
        });


      /*legend title*/
      g.append("text")
        .attr("font-family", "sans-serif")
        .attr("x", -52)
        .attr("y", 58)
        .attr("fill", "#000")
        .attr("text-anchor", "start")
        .attr("font-size", "11px")
        .attr("font-weight", "bold")
        .text("Num Fires (CLICK)");

      /*Place the legend axis with the values in it*/
      g.append("g")
      .attr("transform", "translate(0, 0)")
        .call(d3.axisRight(yLegend)
          .tickSize(0)
          .tickFormat(function (y, i) {
            if (i > 8) return "";
            if (i == 0) return "≤ " + 1000;
            if (i == 1) return "≤ " + 2000;
            if (i == 2) return "≤ " + 3000;
            if (i == 3) return "≤ " + 4000;
            if (i == 4) return "≤ " + 5000;
            if (i == 5) return "≤ " + 6000;
            if (i == 6) return "≤ " + 7000;
            if (i == 7) return "≤ " + 8000;
            if (i == 8) return "≥ " + 10000;
            return y + "%";
          })
          .tickValues(color.domain()))
        .select(".domain")
        .remove()


      // Load in my states data!
      fileName = "./fires_each_state_by_year/" + fileNumber + "_fires_each_state.csv"
      svg.selectAll("path").remove();

      console.log(fileName)

      d3.csv(fileName, function (data) {
        var dataArray = [];
        for (var d = 0; d < data.length; d++) {
          dataArray.push(parseFloat(data[d].value))
        }
        var minVal = d3.min(dataArray)
        var maxVal = d3.max(dataArray)
        var ramp = d3.scaleSequential().domain([minVal, maxVal]).interpolator(d3.interpolateYlOrRd)

        // Load GeoJSON data and merge with states data
        d3.json("us-states.json", function (json) {

          // Loop through each state data value in the .csv file
          for (var i = 0; i < data.length; i++) {

            // Grab State Name
            var dataState = data[i].state;

            // Grab data value 
            var dataValue = data[i].value;

            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++) {
              var jsonState = json.features[j].properties.name;

              if (dataState == jsonState) {

                // Copy the data value into the JSON
                json.features[j].properties.value = dataValue;

                // Stop looking through the JSON
                break;
              }
            }
          }

          // Bind the data to the SVG and create one path per GeoJSON feature
          svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#000")
            .style("stroke-width", ".3")
            .style("fill", function (d) {
              //return ramp(d.properties.value)
              if (d.properties.value <= 1000) return color(1)
              if (d.properties.value <= 2000 && d.properties.value > 1000) return color(2)
              if (d.properties.value <= 3000 && d.properties.value > 2000) return color(3)
              if (d.properties.value <= 4000 && d.properties.value > 3000) return color(4)
              if (d.properties.value <= 5000 && d.properties.value > 4000) return color(5)
              if (d.properties.value <= 6000 && d.properties.value > 5000) return color(6)
              if (d.properties.value <= 7000 && d.properties.value > 6000) return color(7)
              if (d.properties.value <= 8000 && d.properties.value > 7000) return color(8)
              if (d.properties.value > 10000) return color(9)
              return color(8)
            })//ramp(d.properties.value)
            .attr("e", function (d) {
              if (d.properties.value <= 1000) return color(1)
              if (d.properties.value <= 2000 && d.properties.value > 1000) return color(2)
              if (d.properties.value <= 3000 && d.properties.value > 2000) return color(3)
              if (d.properties.value <= 4000 && d.properties.value > 3000) return color(4)
              if (d.properties.value <= 5000 && d.properties.value > 4000) return color(5)
              if (d.properties.value <= 6000 && d.properties.value > 5000) return color(6)
              if (d.properties.value <= 7000 && d.properties.value > 6000) return color(7)
              if (d.properties.value <= 8000 && d.properties.value > 7000) return color(8)
              if (d.properties.value > 10000) return color(9)
              return color(8)
            })//ramp(d.properties.value)
            // .attr("class", function(d) { return ramp(d.properties.value)})
            .on('mouseover', tip.show)
            .on('mouseout', tip.hide)
            .on('click', function () {
              //return svg.selectAll("path").remove()
            })
          // Exit
          svg.exit().remove();

          // svg.selectAll("#legend1").remove();
          d3.selectAll('.axis').remove();
          // add a legend
          var colorScale2 = d3.scaleSequential(d3.interpolateYlOrRd)
            .domain([minVal, maxVal]);
          //continuous("#legend1", colorScale2);
        });


      });


    }
    function updateMapArson(fileNumber, cause) {
      console.log("NOW IN Arson FUNCTION")
      /*Build the vertical legend: create the rectangles, fill with the appropriate color scale*/
      g.selectAll("rect")
        .data(color.range().map(function (d) {
          d = color.invertExtent(d);
          if (d[0] == null) d[0] = yLegend.domain()[0];
          if (d[1] == null) d[1] = yLegend.domain()[1];
          return d;
        }))
        .enter().append("rect")
        .attr("height", 25)
        .attr("x", -50)
        .attr("y", function (d) {
          return yLegend(d[0]) + 12;
        })
        .attr("width", 33)
        .attr("fill", function (d) { return color(d[0]); })
        .attr("col", function (d) { return d[0] })
        .on('mouseover', function input() {
          d3.selectAll("rect")
            //.remove()
            .transition()
            .duration(200)
            .style("opacity", .7)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
        })
        .on('click', function (dis, i, n) {
          d3.selectAll("path").each(function (d) {
            //var a = d["properties"]['value']
            //console.log(d3.select(n[i]).attr("col"))
            var opcaityOnClick = 0.3
            if (d == null) {
              console.log("NK")
              console.log(" is = " + d3.select(n[i]).attr("y"))
            } else if (d["properties"]['value'] > 10000) {
              //d3.select(this).style("opacity", .5)
            }
            if (d3.select(n[i]).attr("y") == 70 && d != null) {
              if (d["properties"]['value'] > 100) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 94 && d != null) {
              if (d["properties"]['value'] < 100 || d["properties"]['value'] > 200) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 118 && d != null) {
              if (d["properties"]['value'] < 200 || d["properties"]['value'] > 300) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 143 && d != null) {
              if (d["properties"]['value'] < 300 || d["properties"]['value'] > 400) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 167 && d != null) {
              if (d["properties"]['value'] < 400 || d["properties"]['value'] > 800) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 191 && d != null) {
              if (d["properties"]['value'] < 800 || d["properties"]['value'] > 1000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 215 && d != null) {
              if (d["properties"]['value'] < 1000 || d["properties"]['value'] > 1200) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 239 && d != null) {
              if (d["properties"]['value'] < 1200 || d["properties"]['value'] > 1300) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 264 && d != null) {
              if (d["properties"]['value'] < 1300) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }

          });
          //style("stroke", "#f00").style("opacity", .1)
          //svg.selectAll('path[attr = "e: 0"]').remove()
          // .transition()
          // .duration(200)
          // .style("opacity", 1)
          d3.selectAll("rect")
            //.remove()
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", .5)
          //         d3.selectAll("path").each(function(d,i) {
          //   console.log("The x position of the rect #" + i + " is " + d3.select(this).attr("e"))
          // })
          // console.log()
          // d3.selectAll("path")
        })
        .on('mouseout', function input() {
          d3.selectAll("path")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
        });


      /*legend title*/
      g.append("text")
        .attr("font-family", "sans-serif")
        .attr("x", -52)
        .attr("y", 58)
        .attr("fill", "#000")
        .attr("text-anchor", "start")
        .attr("font-size", "11px")
        .attr("font-weight", "bold")
        .text("Arson (CLICK)");

      /*Place the legend axis with the values in it*/
      g.append("g")
      .attr("transform", "translate(0, 0)")
        .call(d3.axisRight(yLegend)
          .tickSize(0)
          .tickFormat(function (y, i) {
            if (i > 8) return "";
            if (i == 0) return "≤ " + "100";
            if (i == 1) return "≤ " + "200";
            if (i == 2) return "≤ " + "300";
            if (i == 3) return "≤ " + "400";
            if (i == 4) return "≤ " + "800";
            if (i == 5) return "≤ " + "1000";
            if (i == 6) return "≤ " + "1200";
            if (i == 7) return "≤ " + "1300";
            if (i == 8) return "> " + "1300";
            return y + "%";
          })
          .tickValues(color.domain()))
        .select(".domain")
        .remove()

        // if (d.properties.value <= 100) return color(1)
        //       if (d.properties.value <= 200 && d.properties.value > 100) return color(2)
        //       if (d.properties.value <= 300 && d.properties.value > 200) return color(3)
        //       if (d.properties.value <= 400 && d.properties.value > 300) return color(4)
        //       if (d.properties.value <= 800 && d.properties.value > 400) return color(5)
        //       if (d.properties.value <= 1000 && d.properties.value > 800) return color(6)
        //       if (d.properties.value <= 1200 && d.properties.value > 1000) return color(7)
        //       if (d.properties.value <= 1300 && d.properties.value > 1200) return color(8)
        //       if (d.properties.value > 1300) return color(9)
        //       return color(8)
        

      // Load in my states data!
      fileName = "./arson_causes_fires_each_state_by_year/arson_" + fileNumber + "_fires_each_state.csv"
      svg.selectAll("path").remove();

      console.log(fileName)

      d3.csv(fileName, function (data) {
        var dataArray = [];
        for (var d = 0; d < data.length; d++) {
          dataArray.push(parseFloat(data[d].value))
        }
        var minVal = d3.min(dataArray)
        console.log("minVal = " + minVal)
        var maxVal = d3.max(dataArray)
        console.log("maxVal = " + maxVal)
        var ramp = d3.scaleSequential().domain([minVal, maxVal]).interpolator(d3.interpolateYlOrRd)

        // Load GeoJSON data and merge with states data
        d3.json("us-states.json", function (json) {

          // Loop through each state data value in the .csv file
          for (var i = 0; i < data.length; i++) {

            // Grab State Name
            var dataState = data[i].state;

            // Grab data value 
            var dataValue = data[i].value;

            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++) {
              var jsonState = json.features[j].properties.name;

              if (dataState == jsonState) {

                // Copy the data value into the JSON
                json.features[j].properties.value = dataValue;

                // Stop looking through the JSON
                break;
              }
            }
          }

          // Bind the data to the SVG and create one path per GeoJSON feature
          svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#000")
            .style("stroke-width", ".3")
            .style("fill", function (d) {
              //return ramp(d.properties.value)
              if (d.properties.value <= 100) return color(1)
              if (d.properties.value <= 200 && d.properties.value > 100) return color(2)
              if (d.properties.value <= 300 && d.properties.value > 200) return color(3)
              if (d.properties.value <= 400 && d.properties.value > 300) return color(4)
              if (d.properties.value <= 800 && d.properties.value > 400) return color(5)
              if (d.properties.value <= 1000 && d.properties.value > 800) return color(6)
              if (d.properties.value <= 1200 && d.properties.value > 1000) return color(7)
              if (d.properties.value <= 1300 && d.properties.value > 1200) return color(8)
              if (d.properties.value > 1300) return color(9)
              return color(8)
            })//ramp(d.properties.value)
            .attr("e", function (d) {
              if (d.properties.value <= 100) return color(1)
              if (d.properties.value <= 200 && d.properties.value > 100) return color(2)
              if (d.properties.value <= 300 && d.properties.value > 200) return color(3)
              if (d.properties.value <= 400 && d.properties.value > 300) return color(4)
              if (d.properties.value <= 800 && d.properties.value > 400) return color(5)
              if (d.properties.value <= 1000 && d.properties.value > 800) return color(6)
              if (d.properties.value <= 1200 && d.properties.value > 1000) return color(7)
              if (d.properties.value <= 1300 && d.properties.value > 1200) return color(8)
              if (d.properties.value > 1300) return color(9)
              return color(8)
            })//ramp(d.properties.value)
            // .attr("class", function(d) { return ramp(d.properties.value)})
            .on('mouseover', tip.show)
            .on('mouseout', tip.hide)
            .on('click', function () {
              //return svg.selectAll("path").remove()
            })
          // Exit
          svg.exit().remove();

          // svg.selectAll("#legend1").remove();
          d3.selectAll('.axis').remove();
          // add a legend
          var colorScale2 = d3.scaleSequential(d3.interpolateYlOrRd)
            .domain([minVal, maxVal]);
          //continuous("#legend1", colorScale2);
        });


      });

    }

    function updateMap(fileNumber, cause) {
      console.log("Cause in update map is: " + cause)
      const expr = 'Papayas';
      switch (cause) {
        case 'All causes':
          g.selectAll("rect").remove()
          g.selectAll("text").remove()
          updateMapAllCauses(fileNumber, cause)
          break;
        case 'Arson':
          console.log("Campfires under construction ...");
          g.selectAll("rect").remove()
          g.selectAll("text").remove()
          updateMapArson(fileNumber, cause)
          break;
        case 'Campfires':
          console.log("Arson under construction ...");
          break;
        case 'Children':
          break;
        default:
          console.log("lsl");
      }
    }

    // create continuous color legend
    function continuous(selector_id, colorscale) {

      var legendheight = 300,
        legendwidth = 120,
        margin = { top: 50, right: 60, bottom: 20, left: 5 };

      var canvas = d3.select(selector_id)
        .style("height", legendheight + "px")
        .style("width", legendwidth + "px")
        .style("position", "absolute")
        .append("canvas")
        .attr("height", legendheight - margin.top - margin.bottom)
        .attr("width", 1)
        .style("height", (legendheight - margin.top - margin.bottom) + "px")
        .style("width", (legendwidth - margin.left - margin.right) + "px")
        // .style("border", "1px solid #000")
        .style("position", "absolute")
        .style("top", (margin.top) + "px")
        .style("left", (margin.left) + "px")
        .node();

      var ctx = canvas.getContext("2d");

      var legendscale = d3.scaleLinear()
        .range([1, legendheight - margin.top - margin.bottom])
        .domain(colorscale.domain());

      var image = ctx.createImageData(1, legendheight);
      d3.range(legendheight).forEach(function (i) {
        var c = d3.rgb(colorscale(legendscale.invert(i)));
        image.data[4 * i] = c.r;
        image.data[4 * i + 1] = c.g;
        image.data[4 * i + 2] = c.b;
        image.data[4 * i + 3] = 255;
      });
      ctx.putImageData(image, 0, 0);

      var legendaxis = d3.axisRight()
        .scale(legendscale)
        .tickSize(6)
        .ticks(10);

      var svg = d3.select(selector_id)
        .append("svg")
        .attr("height", 300)//(legendheight) + "px")
        .attr("width", 140)//(legendwidth) + "px")
        .style("position", "absolute")
        .style("left", "0px")
        .style("top", "0px")
      svg
        .append("g")
        .attr("class", "axis")
        .attr("transform", "translate(" + (legendwidth - margin.left - margin.right + 5) + "," + (margin.top) + ")")
        .call(legendaxis);

    };

    //resize();
    //d3.select(window).on("resize", resize);

    function initialMap() {

      /*Build the vertical legend: create the rectangles, fill with the appropriate color scale*/
      g.selectAll("rect")
        .data(color.range().map(function (d) {
          d = color.invertExtent(d);
          if (d[0] == null) d[0] = yLegend.domain()[0];
          if (d[1] == null) d[1] = yLegend.domain()[1];
          return d;
        }))
        .enter().append("rect")
        .attr("height", 25)
        .attr("x", -50)
        .attr("y", function (d) {
          return yLegend(d[0]) + 12;
        })
        .attr("width", 33)
        .attr("fill", function (d) { return color(d[0]); })
        .attr("col", function (d) { return d[0] })
        .on('mouseover', function input() {
          d3.selectAll("rect")
            //.remove()
            .transition()
            .duration(200)
            .style("opacity", .7)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
        })
        .on('click', function (dis, i, n) {
          d3.selectAll("path").each(function (d) {
            //var a = d["properties"]['value']
            //console.log(d3.select(n[i]).attr("col"))
            var opcaityOnClick = 0.3
            if (d == null) {
              console.log("NK")
              console.log(" is = " + d3.select(n[i]).attr("y"))
            } else if (d["properties"]['value'] > 10000) {
              //d3.select(this).style("opacity", .5)
            }
            if (d3.select(n[i]).attr("y") == 70 && d != null) {
              if (d["properties"]['value'] > 1000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 94 && d != null) {
              if (d["properties"]['value'] < 1000 || d["properties"]['value'] > 2000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 118 && d != null) {
              if (d["properties"]['value'] < 2000 || d["properties"]['value'] > 3000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 143 && d != null) {
              if (d["properties"]['value'] < 3000 || d["properties"]['value'] > 4000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 167 && d != null) {
              if (d["properties"]['value'] < 4000 || d["properties"]['value'] > 5000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 191 && d != null) {
              if (d["properties"]['value'] < 5000 || d["properties"]['value'] > 6000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 215 && d != null) {
              if (d["properties"]['value'] < 6000 || d["properties"]['value'] > 7000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 239 && d != null) {
              if (d["properties"]['value'] < 7000 || d["properties"]['value'] > 8000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }
            if (d3.select(n[i]).attr("y") == 264 && d != null) {
              if (d["properties"]['value'] < 10000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
              //console.log(d["properties"]['value'])
            }

          });
          //style("stroke", "#f00").style("opacity", .1)
          //svg.selectAll('path[attr = "e: 0"]').remove()
          // .transition()
          // .duration(200)
          // .style("opacity", 1)
          d3.selectAll("rect")
            //.remove()
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", .5)
          //         d3.selectAll("path").each(function(d,i) {
          //   console.log("The x position of the rect #" + i + " is " + d3.select(this).attr("e"))
          // })
          // console.log()
          // d3.selectAll("path")
        })
        .on('mouseout', function input() {
          d3.selectAll("path")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
        });


      /*legend title*/
      g.append("text")
        .attr("font-family", "sans-serif")
        .attr("x", -52)
        .attr("y", 58)
        .attr("fill", "#000")
        .attr("text-anchor", "start")
        .attr("font-size", "11px")
        .attr("font-weight", "bold")
        .text("Num Fires (CLICK)");

      /*Place the legend axis with the values in it*/
      g.attr("transform", "translate(55, 0)")
        .call(d3.axisRight(yLegend)
          .tickSize(0)
          .tickFormat(function (y, i) {
            if (i > 8) return "";
            if (i == 0) return "≤ " + 1000;
            if (i == 1) return "≤ " + 2000;
            if (i == 2) return "≤ " + 3000;
            if (i == 3) return "≤ " + 4000;
            if (i == 4) return "≤ " + 5000;
            if (i == 5) return "≤ " + 6000;
            if (i == 6) return "≤ " + 7000;
            if (i == 7) return "≤ " + 8000;
            if (i == 8) return "≥ " + 10000;
            return y + "%";
          })
          .tickValues(color.domain()))
        .select(".domain")
        .remove()

      //draw map based on csv file data
      d3.csv("./fires_each_state_by_year/1992_fires_each_state.csv", function (data) {
        var dataArray = [];
        for (var d = 0; d < data.length; d++) {
          dataArray.push(parseFloat(data[d].value))
        }
        var minVal = d3.min(dataArray)
        var maxVal = d3.max(dataArray)
        var ramp = d3.scaleSequential().domain([minVal, maxVal]).interpolator(d3.interpolateYlOrRd)

        // Load GeoJSON data and merge with states data
        d3.json("us-states.json", function (json) {

          // Loop through each state data value in the .csv file
          for (var i = 0; i < data.length; i++) {

            // Grab State Name
            var dataState = data[i].state;

            // Grab data value 
            var dataValue = data[i].value;

            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++) {
              var jsonState = json.features[j].properties.name;

              if (dataState == jsonState) {

                // Copy the data value into the JSON
                json.features[j].properties.value = dataValue;

                // Stop looking through the JSON
                break;
              }
            }
          }

          // Bind the data to the SVG and create one path per GeoJSON feature
          svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#000")
            .style("stroke-width", ".3")
            .style("fill", function (d) {
              if (d.properties.value <= 1000) return color(1)
              if (d.properties.value <= 2000 && d.properties.value > 1000) return color(2)
              if (d.properties.value <= 3000 && d.properties.value > 2000) return color(3)
              if (d.properties.value <= 4000 && d.properties.value > 3000) return color(4)
              if (d.properties.value <= 5000 && d.properties.value > 4000) return color(5)
              if (d.properties.value <= 6000 && d.properties.value > 5000) return color(6)
              if (d.properties.value <= 7000 && d.properties.value > 6000) return color(7)
              if (d.properties.value <= 8000 && d.properties.value > 7000) return color(8)
              if (d.properties.value > 10000) return color(9)
              return color(9)
            })//ramp(d.properties.value)
            .on('mouseover', tip.show)
            .on('mouseout', tip.hide)
          // Exit
          svg.exit().remove();

          // svg.selectAll("#legend1").remove();
          d3.selectAll('.axis').remove();
          // add a legend
          var colorScale2 = d3.scaleSequential(d3.interpolateYlOrRd)
            .domain([minVal, maxVal]);
          //continuous("#legend1", colorScale2);
        });

      });
    }

    initialMap();
  </script>
</body>

</html>
