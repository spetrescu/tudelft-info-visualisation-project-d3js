<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <script type="text/javascript" nonce="a6f79910b59e4ca48a00da0cda5"
    src="//local.adguard.org?ts=1607701659773&amp;type=content-script&amp;dmn=bl.ocks.org&amp;app=com.apple.Safari&amp;css=1&amp;js=1&amp;gcss=1&amp;rel=1&amp;rji=1&amp;sbe=0"></script>
  <script type="text/javascript" nonce="a6f79910b59e4ca48a00da0cda5"
    src="//local.adguard.org?ts=1607701659773&amp;name=AdGuard%20Extra&amp;type=user-script"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>

  </script>
  <script src="https://d3js.org/d3-color.v1.min.js">
  </script>
  <script src="https://d3js.org/d3-interpolate.v1.min.js">
  </script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js">
  </script>

  <style type="text/css">
    body {
      position: relative;
      min-width: 900px;
      height: 100%;
      max-height: 100%;
      font-family: 'Montserrat', sans-serif;
      line-height: 1.5em;
      font-size: 18px;
    }

    .bar {
      fill: #fc4e2a;
    }

    main {
      top: 50px;
      bottom: 40px;
      left: 0;
      right: 0;
      overflow: auto;
      background: #EFEFEF;
      width: 100%;
      min-width: 900px;
    }

    input[type=range] {
      -webkit-appearance: none;
      width: 800px;
      height: 10px;
    }

    input[type=range]::-webkit-slider-runnable-track {
      width: 800px;
      height: 5px;
      background: #ddd;
      border: none;
      border-radius: 3px;
    }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      border: none;
      height: 15px;
      width: 25px;
      border-radius: 20%;
      background: rgb(255, 183, 1);
      margin-top: -3px;
      margin-left: 3px;
    }

    input[type=range]:focus {
      outline: none;
    }

    input[type=range]:focus::-webkit-slider-runnable-track {
      background: #ccc;
    }

    input[type=range]:hover {
      opacity: .8;
    }


    body {
      font: 15px sans-serif;
      background-color: #ffffff;
    }

    div.tooltip {
      position: absolute;
      text-align: center;
      width: 60px;
      height: 28px;
      padding: 2px;
      font: 12px sans-serif;
      background: rgb(34, 19, 19);
      border: 0px;
      border-radius: 8px;
      pointer-events: none;
    }

    .d3-tip {
      line-height: 1;
      padding: 12px;
      background: rgba(43, 43, 43, 0.8);
      color: #fff;
      border-radius: 2px;
    }

    .legend {
      position: absolute;
      left: 20px;
      top: 30px;
    }

    .axis text {
      font: 10px sans-serif;
    }

    path:hover {
      fill-opacity: .5;
    }

    .axis line,
    .axis path {
      fill: none;
      stroke: rgb(95, 95, 95);
      shape-rendering: crispEdges;
    }

    /*style for select dropdown*/
    select {
      margin: 5px;
      width: 150px;
      padding: 5px 35px 5px 5px;
      font-size: 17px;
      border: 1px solid #CCC;
      height: 34px;
      appearance: none;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>

</head>

<body style="background-color:#cccccc"">
  <h1>Wildfires in USA in <span id="nRadius-value">1992</span> for <select id="selectButton">ALL CAUSES</select></h1>

  <div style="position: absolute" style="top: 80px">
    <input type="range" min="1992" max="2015" id="nRadius" step="1" value="1992"> <b><span
        id="nRadius-value2">1992</span></b>
  </div>
  <svg style="border:1px solid black" width="900" height="500" id="svgZ"></svg>

  <svg style="border:1px solid black" style="background-position: bottom" width="900" height="500" id="svg3">
    <foreignobject class="node" x="730" y="20" width="200" height="100">
      <select id="selectButtonStates"></select>
    </foreignobject>
    <foreignobject class="node" x="730" y="60" width="200" height="100">
      <select id="selectButtonYears"></select>
    </foreignobject>
  </svg>

  <svg style="border:1px solid black" style="background-position: bottom" width="900" height="500" id="svgLineChart">
    <foreignobject class="node" x="730" y="20" width="200" height="100">
      <select id="selectStateForLineChart"></select>
    </foreignobject>
  </svg>


  <script type="text/javascript">
    
    //function that helps with actually linking the visual data with the files
    function getStateAbbreviation(stateName) {
      states = ["Alabama", "Alaska", "Arkansas", "Arizona", "California", "Colorado", "Connecticut", "Delaware", "District of Columbia", "Florida", "Georgia", "Hawaii", "Iowa", "Idaho", "Illinois", "Indiana", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Missouri", "Mississippi", "Montana", "North Carolina", "North Dakota", "Nebraska", "New Hampshire", "New Jersey", "New Mexico", "Nevada", "New York", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Virginia", "Vermont", "Washington", "Wisconsin", "West Virginia", "Wyoming", "All states"]
      statesAbbreviated = ["AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DC", "DE", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"]
      if (stateName == "All states")
        return states[states.length - 1]
      return statesAbbreviated[states.indexOf(stateName)];
    }

    // set the dimensions and margins of the horizontal bar graph
    var margin_for_bar_chart = { top: 60, right: 50, bottom: 40, left: 90 },
      width_for_bar_chart = 780 - margin_for_bar_chart.left - margin_for_bar_chart.right,
      height_for_bar_chart = 500 - margin_for_bar_chart.top - margin_for_bar_chart.bottom;

    function plotHorizontalBarChart(filename) {
      d3.csv(filename, function (data) {
        var dataArray = [];
        var yearsArray = [];
        for (var d = 0; d < data.length; d++) {
          dataArray.push(parseFloat(data[d].NumOfFires))
          yearsArray.push(parseFloat(data[d].Cause))
        }
        var minVal_barChart = d3.min(dataArray)
        maxVal_barChart = d3.max(dataArray)

        // set the ranges
        var y_barChart = d3.scaleBand()
          .range([height_for_bar_chart, 0])
          .padding(0.1);

        var x_barChart = d3.scaleLinear()
          .range([0, width_for_bar_chart]);

        var svg3 = d3.select("#svg3").append("svg")
          .attr("width", width_for_bar_chart + margin_for_bar_chart.left + margin_for_bar_chart.right)
          .attr("height", height_for_bar_chart + margin_for_bar_chart.top + margin_for_bar_chart.bottom)
          .append("g")
          .attr("transform",
            "translate(" + margin_for_bar_chart.left + "," + margin_for_bar_chart.top + ")");

        var buttonNames = ["All states", "button 2", "button 3", "button 4"];

        var statesBarChart = ["All states", "Alabama", "Alaska", "Arkansas", "Arizona", "California", "Colorado", "Connecticut", "Delaware", "District of Columbia", "Florida", "Georgia", "Hawaii", "Iowa", "Idaho", "Illinois", "Indiana", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Missouri", "Mississippi", "Montana", "North Carolina", "North Dakota", "Nebraska", "New Hampshire", "New Jersey", "New Mexico", "Nevada", "New York", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Virginia", "Vermont", "Washington", "Wisconsin", "West Virginia", "Wyoming"]
        var yearsBarChart =
          ["All years",
            "2015", "2014", "2013", "2012", "2011", "2010",
            "2009", "2008", "2007", "2006", "2005", "2004", 
            "2003", "2002", "2001", "2000", "1999", "1998", 
            "1997", "1996", "1995", "1994", "1993", "1992"]

        // add the options to the button
        d3.select("#selectButtonStates")
          .selectAll('myOptions')
          .data(statesBarChart)
          .enter()
          .append('option')
          .text(function (d) { return d; }) // text showed in the menu
          .attr("value", function (d) { return d; }) // corresponding value returned by the button
          .attr("height", 60)
        d3.select("#selectButtonYears")
          .selectAll('myOptions')
          .data(yearsBarChart)
          .enter()
          .append('option')
          .text(function (d) { return d; }) // text showed in the menu
          .attr("value", function (d) { return d; }) // corresponding value returned by the button
          .attr("height", 60)

        x_barChart.domain([0, maxVal_barChart])
        y_barChart.domain(data.map(function (d) { return d.Cause; }));

        // append the rectangles for the bar chart
        var bars = svg3.selectAll(".bar")
          .data(data)
          .enter().append("rect")
          .attr("class", "bar")
          //.attr("x", function(d) { return x(d.sales); })
          .attr("width", function (d) { return x_barChart(d.NumOfFires); })
          .attr("y", function (d) { return y_barChart(d.Cause); })
          .attr("height", y_barChart.bandwidth())
          //.attr("e", function (d) {})
          .attr("efz", function (d) { return d.NumOfFires; })

        // add the x Axis
        var xAxis = svg3.append("g")
          //.transition().duration(250)
          .attr("transform", "translate(0," + height_for_bar_chart + ")")
          .call(d3.axisBottom(x_barChart));


        // add the y Axis
        svg3.append("g")
          .call(d3.axisLeft(y_barChart));


        //x axis title        
        svg3.append("text")
          .attr("x", height_for_bar_chart - margin_for_bar_chart.left)
          .attr("y", height_for_bar_chart + 32)
          .attr("text-anchor", "middle")
          .attr("font-family", "sans-serif")
          .attr("font-size", "14px")
          .attr("font-weight", "bold")
          .attr("fill", "black")
          .text("Number of fires");

        //y axis title        
        svg3.append("text")
          .attr("x", (-height_for_bar_chart / 2))
          .attr("transform", "rotate(-90)")
          .attr("y", -60)
          .attr("text-anchor", "middle")
          .attr("font-family", "sans-serif")
          .attr("font-size", "14px")
          .attr("font-weight", "bold")
          .attr("fill", "black")
          .text("Causes");

        //title        
        svg3.append("text")
          .attr("x", height_for_bar_chart - margin_for_bar_chart.left)
          .attr("y", -10)
          .attr("text-anchor", "middle")
          .attr("font-family", "sans-serif")
          .attr("font-size", "20px")
          .attr("font-weight", "bold")
          .attr("fill", "black")
          .text("Number of fires by specific causes");


        svg3.selectAll('rect')
          .on('mouseover', function input() {
            d3.select(this)
              .style("opacity", 1)
              .style("fill", "#800026");

            //add tooltip for exact data
            leftMargin = width_for_bar_chart * 0.005

            //set up data to show on mouseover
            var xPosition = (parseFloat(d3.select(this).attr("width")) + leftMargin);
            var yPosition = parseFloat(d3.select(this).attr("y")) + (parseFloat(d3.select(this).attr("height")) / 2);

            svg3.append("text")
              .attr("id", "tooltip")
              .attr("x", xPosition)
              .attr("y", yPosition)
              .attr("dy", "0.35em")
              .attr("text-anchor", "start")
              .attr("font-family", "sans-serif")
              .attr("font-size", "12px")
              .attr("font-weight", "bold")
              .attr("fill", "black")
              .text(d3.select(this).attr("efz"));
          })
          .on('mouseout', function input() {
            d3.select(this)
              .style("opacity", 1)
              .style("fill", "#fc4e2a");
            d3.select("#tooltip").remove();
          });

      });
    }



    //create new horizontal bar chart => this is called each time a state is clicked on the map OR a selection is being made from the 2 buttons
    function plotNewHorizontalBarChart(filename) {

      d3.select("#svg3").selectAll("g").remove()

      d3.csv(filename, function (data) {
        
        var numberFiresArray = [];
        var causeArray = [];

        for (var d = 0; d < data.length; d++) {
          numberFiresArray.push(parseFloat(data[d].NumOfFires))
          causeArray.push(data[d].Cause)
        }
        var minVal_barChart = d3.min(numberFiresArray)
        maxVal_barChart = d3.max(numberFiresArray)

        // set the ranges
        var y_barChart = d3.scaleBand()
          .range([height_for_bar_chart, 0])
          .padding(0.1);

        var x_barChart = d3.scaleLinear()
          .range([0, width_for_bar_chart]);

        var svg3 = d3.select("#svg3").append("svg")
          .attr("width", width_for_bar_chart + margin_for_bar_chart.left + margin_for_bar_chart.right)
          .attr("height", height_for_bar_chart + margin_for_bar_chart.top + margin_for_bar_chart.bottom)
          .append("g")
          .attr("transform",
            "translate(" + margin_for_bar_chart.left + "," + margin_for_bar_chart.top + ")");

        x_barChart.domain([0, maxVal_barChart])
        y_barChart.domain(data.map(function (d) { return d.Cause; }));

        // append the rectangles for the bar chart
        var bars = svg3.selectAll(".bar")
          .data(data)
          .enter().append("rect")
          .attr("class", "bar")
          //.attr("x", function(d) { return x(d.sales); })
          .attr("width", function (d) { return x_barChart(d.NumOfFires); })
          .attr("y", function (d) { return y_barChart(d.Cause); })
          .attr("height", y_barChart.bandwidth())
          //.attr("e", function (d) {})
          .attr("efzjjjj", function (d) { return d.NumOfFires; })
          .attr("fill", "black")

        // add the x Axis
        var xAxis = svg3.append("g")
          .transition().duration(250)
          .attr("transform", "translate(0," + height_for_bar_chart + ")")
          .call(d3.axisBottom(x_barChart));

        // add the y Axis
        svg3.append("g")
          .transition().duration(250)
          .call(d3.axisLeft(y_barChart));

        //x axis title        
        svg3.append("text")
          .attr("x", height_for_bar_chart - margin_for_bar_chart.left)
          .attr("y", height_for_bar_chart + 32)
          .attr("text-anchor", "middle")
          .attr("font-family", "sans-serif")
          .attr("font-size", "14px")
          .attr("font-weight", "bold")
          .attr("fill", "black")
          .text("Number of fires");

        //y axis title        
        svg3.append("text")
          .attr("x", (-height_for_bar_chart / 2))
          .attr("transform", "rotate(-90)")
          .attr("y", -60)
          .attr("text-anchor", "middle")
          .attr("font-family", "sans-serif")
          .attr("font-size", "14px")
          .attr("font-weight", "bold")
          .attr("fill", "black")
          .text("Causes");

        //title        
        svg3.append("text")
          .attr("x", height_for_bar_chart - margin_for_bar_chart.left)
          .attr("y", -10)
          .attr("text-anchor", "middle")
          .attr("font-family", "sans-serif")
          .attr("font-size", "20px")
          .attr("font-weight", "bold")
          .attr("fill", "black")
          .text("Number of fires by specific causes");

        svg3.selectAll('rect')
          .on('mouseover', function input() {
            d3.select(this)
              .style("opacity", 1)
              .style("fill", "#800026");

            //add tooltip for exact data
            leftMargin = width_for_bar_chart * 0.005

            //set up data to show on mouseover
            var xPosition = (parseFloat(d3.select(this).attr("width")) + leftMargin);
            console.log("leftMargin is " + leftMargin)
            var yPosition = parseFloat(d3.select(this).attr("y")) + (parseFloat(d3.select(this).attr("height")) / 2);

            svg3.append("text")
              .attr("id", "tooltip")
              .attr("x", xPosition)
              .attr("y", yPosition)
              .attr("dy", "0.35em")
              .attr("text-anchor", "start")
              .attr("font-family", "sans-serif")
              .attr("font-size", "12px")
              .attr("font-weight", "bold")
              .attr("fill", "black")
              .text(d3.select(this).attr("efzjjjj"));
          })
          .on('mouseout', function input() {
            d3.select(this)
              .style("opacity", 1)
              .style("fill", "#fc4e2a");
            d3.select("#tooltip").remove();
          });
      });
    }

    // set the dimensions and margins of the horizontal bar graph
    var margin_for_line_chart = { top: 90, right: 50, bottom: 40, left: 90 },
      width_for_line_chart = 780 - margin_for_line_chart.left - margin_for_line_chart.right,
      height_for_line_chart = 500 - margin_for_line_chart.top - margin_for_line_chart.bottom;

    function plotLineChart() {
      var svgLineChart = d3.select("#svgLineChart")
        .append("svg")
        .attr("width", width_for_line_chart + margin_for_line_chart.left + margin_for_line_chart.right)
        .attr("height", height_for_line_chart + margin_for_line_chart.top + margin_for_line_chart.bottom)
        .append("g")
        .attr("transform", "translate(" + margin_for_line_chart.left + "," + margin_for_line_chart.top + ")");


      var statesBarChart = ["Alabama", "Alaska", "Arkansas", "Arizona", "California", "Colorado", "Connecticut", "Delaware", "District of Columbia", "Florida", "Georgia", "Hawaii", "Iowa", "Idaho", "Illinois", "Indiana", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Missouri", "Mississippi", "Montana", "North Carolina", "North Dakota", "Nebraska", "New Hampshire", "New Jersey", "New Mexico", "Nevada", "New York", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Virginia", "Vermont", "Washington", "Wisconsin", "West Virginia", "Wyoming"]
      // add the options to the button
      d3.select("#selectStateForLineChart")
        .selectAll('myOptions')
        .data(statesBarChart)
        .enter()
        .append('option')
        .text(function (d) { return d; }) // text showed in the menu
        .attr("value", function (d) { return d; }) // corresponding value returned by the button

      //the code for the line chart was inspired from https://www.d3-graph-gallery.com/graph/line_basic.html
      //Read the data
      d3.csv("./line_graph_data/dataForLineGraph.csv",

        function (d) {
          return { date: d3.timeParse("%Y-%m-%d")(d.date), value: d.value }
        },

        function (data) {

          var x = d3.scaleTime()
            .domain(d3.extent(data, function (d) { return d.date; }))
            .range([0, width_for_line_chart]);
          svgLineChart.append("g")
            .attr("transform", "translate(0," + height_for_line_chart + ")")
            .call(d3.axisBottom(x));

          var y = d3.scaleLinear()
            .domain([0, d3.max(data, function (d) { return +d.value; })])
            .range([height_for_line_chart, 0]);
          svgLineChart.append("g")
            .call(d3.axisLeft(y));

          svgLineChart.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "#e31a1c")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
              .x(function (d) { return x(d.date) })
              .y(function (d) { return y(d.value) })
            )

          //x axis title        
          svgLineChart.append("text")
            .attr("x", width_for_line_chart / 2)
            .attr("y", height_for_line_chart + 32)
            .attr("text-anchor", "middle")
            .attr("font-family", "sans-serif")
            .attr("font-size", "14px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .text("Year");

          //y axis title        
          svgLineChart.append("text")
            .attr("x", (-height_for_line_chart / 2 - 10))
            .attr("transform", "rotate(-90)")
            .attr("y", -60)
            .attr("text-anchor", "middle")
            .attr("font-family", "sans-serif")
            .attr("font-size", "14px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .text("Number of fires");

          //title        
          svgLineChart.append("text")
            .attr("x", height_for_line_chart - margin_for_line_chart.left)
            .attr("y", -40)
            .attr("text-anchor", "middle")
            .attr("font-family", "sans-serif")
            .attr("font-size", "20px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .text("Number of fires 1992-2015 in specific state");

          // Data dots
          svgLineChart.selectAll("line-circle")
            .data(data)
            .enter().append("circle")
            .attr("class", "data-circle")
            .style("fill", "#e31a1c")
            .attr("r", 7)
            .attr("circleValue", function (d) { return d.value; })
            .attr("yearValue", function (d) {
              var yearDate = d.date;
              year = yearDate.getFullYear();
              return year;
            })
            .attr("cx", function (d) { return x(d.date); })
            .attr("cy", function (d) { return y(d.value); });

          svgLineChart.selectAll('circle')
            .on('mouseover', function input() {
              d3.select(this)
                .style("opacity", 1)
                .style("fill", "#ffffcc");

              //add tooltip for exact data
              leftMargin = width_for_line_chart * 0.005

              //set up data to show on mouseover
              var xPosition = (parseFloat(d3.select(this).attr("width")) + leftMargin);
              console.log("leftMargin is " + leftMargin)
              var yPosition = parseFloat(d3.select(this).attr("y")) + (parseFloat(d3.select(this).attr("height")) / 2);

              svgLineChart.append("text")
                .attr("id", "tooltip")
                .attr("x", d3.select(this).attr("cx") - 10)
                .attr("y", d3.select(this).attr("cy") - 20)
                .attr("dy", "0.35em")
                .attr("text-anchor", "start")
                .attr("font-family", "sans-serif")
                .attr("font-size", "15px")
                .attr("font-weight", "bold")
                .attr("fill", "black")
                .text(d3.select(this).attr("circleValue"));
            })
            .on('mouseout', function input() {
              d3.select(this)
                .style("opacity", 1)
                .style("fill", "#e31a1c");
              d3.select("#tooltip").remove();
            });
        })
    }

    //initial line chart
    plotLineChart()

    function updateLineChart(abbreviatedStatename) {

      //remove 
      d3.select("#svgLineChart").selectAll("g").remove()
      //selectStateForLineChart
      var svgLineChart = d3.select("#svgLineChart")
        .append("svg")
        .attr("width", width_for_line_chart + margin_for_line_chart.left + margin_for_line_chart.right)
        .attr("height", height_for_line_chart + margin_for_line_chart.top + margin_for_line_chart.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin_for_line_chart.left + "," + margin_for_line_chart.top + ")");

      fileNameForLineChart = "./line_graph_data/line_chart_causes_all_years_" + abbreviatedStatename + "_fires_each_state.csv"


      //Read the data
      d3.csv(fileNameForLineChart,

        // When reading the csv, I must format variables:
        function (d) {
          return { date: d3.timeParse("%Y-%m-%d")(d.date), value: d.value }
        },

        // Now I can use this dataset:
        function (data) {

          // Add X axis --> it is a date format
          var x = d3.scaleTime()
            .domain(d3.extent(data, function (d) { return d.date; }))
            .range([0, width_for_line_chart]);
          svgLineChart.append("g")
            .attr("transform", "translate(0," + height_for_line_chart + ")")
            .call(d3.axisBottom(x));

          // Add Y axis
          var y = d3.scaleLinear()
            .domain([0, d3.max(data, function (d) { return +d.value; })])
            .range([height_for_line_chart, 0]);
          svgLineChart.append("g")
            .call(d3.axisLeft(y));

          // Add the line
          svgLineChart.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "#e31a1c")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
              .x(function (d) { return x(d.date) })
              .y(function (d) { return y(d.value) })
            )
          //x axis title        
          svgLineChart.append("text")
            .attr("x", width_for_line_chart / 2)
            .attr("y", height_for_line_chart + 32)
            .attr("text-anchor", "middle")
            .attr("font-family", "sans-serif")
            .attr("font-size", "14px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .text("Year");

          //y axis title        
          svgLineChart.append("text")
            .transition().duration(250)
            .attr("x", (-height_for_line_chart / 2 - 10))
            .attr("transform", "rotate(-90)")
            .attr("y", -60)
            .attr("text-anchor", "middle")
            .attr("font-family", "sans-serif")
            .attr("font-size", "14px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .text("Number of fires");

          //title        
          svgLineChart.append("text")
            .attr("x", height_for_line_chart - margin_for_line_chart.left)
            .attr("y", -40)
            .attr("text-anchor", "middle")
            .attr("font-family", "sans-serif")
            .attr("font-size", "20px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .text("Number of fires 1992-2015 in specific state");

          svgLineChart.selectAll("line-circle")
            .data(data)
            .enter().append("circle")
            .attr("class", "data-circle")
            .attr("circleValue", function (d) { return d.value; })
            .style("fill", "#e31a1c")
            .attr("r", 7)
            .attr("cx", function (d) { return x(d.date); })
            .attr("cy", function (d) { return y(d.value); });
          svgLineChart.selectAll('circle')
            .on('mouseover', function input() {
              d3.select(this)
                .style("opacity", 1)
                .style("fill", "#ffffcc");

              //add tooltip for exact data

              leftMargin = width_for_line_chart * 0.005

              //set up data to show on mouseover
              var xPosition = (parseFloat(d3.select(this).attr("width")) + leftMargin);
              console.log("leftMargin is " + leftMargin)
              var yPosition = parseFloat(d3.select(this).attr("y")) + (parseFloat(d3.select(this).attr("height")) / 2);

              svgLineChart.append("text")
                .attr("id", "tooltip")
                .attr("x", d3.select(this).attr("cx"))
                .attr("y", d3.select(this).attr("cy") - 20)
                .attr("dy", "0.35em")
                .attr("text-anchor", "start")
                .attr("font-family", "sans-serif")
                .attr("font-size", "15px")
                .attr("font-weight", "bold")
                .attr("fill", "black")
                .text(d3.select(this).attr("circleValue"));
            })
            .on('mouseout', function input() {
              d3.select(this)
                .style("opacity", 1)
                .style("fill", "#e31a1c");
              d3.select("#tooltip").remove();
            });

        })

    }

    //listen for changes on line chart
    d3.select("#selectStateForLineChart").on("change", function () {
      var selectedOptionState = d3.select(this).property("value")
      var abbreviatedStatename = getStateAbbreviation(selectedOptionState)
      //var selectedOptionYear = d3.select("#selectButtonYears").property("value")
      updateLineChart(abbreviatedStatename)
    });

    //create intial horizontal bar chart
    initial_filename_horizontal_bar_chart = "./horizontal_graph/all_states_all_years_fires_causes.csv"
    plotHorizontalBarChart(initial_filename_horizontal_bar_chart);

    //update the horizontal bar chart
    function updateHorizontalBarChart(selectedOptionState, selectedOptionYear) {
      if (selectedOptionState == "All states" && selectedOptionYear == "All years") {
        filename = "./horizontal_graph/all_states_all_years_fires_causes.csv"
        plotNewHorizontalBarChart(filename);
      } else if (selectedOptionState == "All states" && selectedOptionYear != "All years") {
        filename = "./horizontal_graph/all_states/causes_" + selectedOptionYear + "_fires_each_state.csv"
        plotNewHorizontalBarChart(filename);
      } else if (selectedOptionYear != "All states" && selectedOptionYear != "All years") {
        filename = "./causes/" + selectedOptionYear + "_causes_each_state/causes_" + selectedOptionYear + "_" + selectedOptionState + "_fires_each_state.csv"
        plotNewHorizontalBarChart(filename);
      } else if (selectedOptionState != "All states" && selectedOptionYear == "All years") {
        filename = "./causes_all_years/" + "causes_all_years_" + selectedOptionState + "_fires_each_state.csv"
        plotNewHorizontalBarChart(filename);
      }

    }

    //listen to change on selectButtonStates menu
    d3.select("#selectButtonStates").on("change", function () {
      var selectedOptionState = d3.select(this).property("value")

      var abbreviatedStatename = getStateAbbreviation(selectedOptionState)
      var selectedOptionYear = d3.select("#selectButtonYears").property("value")
      updateHorizontalBarChart(abbreviatedStatename, selectedOptionYear)
    });

    //listen to change on selectButtonStates menu
    d3.select("#selectButtonYears").on("change", function () {
      var selectedOptionYear = d3.select(this).property("value")
      var selectedOptionState = d3.select("#selectButtonStates").property("value")
      var abbreviatedStatename = getStateAbbreviation(selectedOptionState)
      updateHorizontalBarChart(abbreviatedStatename, selectedOptionYear)
    });

    //select menu for causes
    // List of groups (here I have one group per column)
    var allGroup = ["All causes", "Arson"] //if more data about fire causes => more options would have been possible
    d3.select("#selectButton")
      .selectAll('myOptions')
      .data(allGroup)
      .enter()
      .append('option')
      .text(function (d) { return d; }) // text showed in the menu
      .attr("value", function (d) { return d; })

    //listen to change on select menu
    d3.select("#selectButton").on("change", function () {
      var selectedOption = d3.select(this).property("value")
      titleYear = document.getElementById('nRadius-value2').innerHTML;
      updateMap(titleYear, selectedOption);
    });

    // when the input range changes update
    d3.select("#nRadius").on("input", function () {
      // adjust the text on the range slider
      d3.select("#nRadius-value").text(+this.value);
      d3.select("#nRadius-value2").text(+this.value);
      cause = d3.select("#selectButton").property("value");
      updateMap(+this.value, cause);
    });


    var yLegend = d3.scaleLinear()
      .domain([1, 11])
      .rangeRound([58, 300]);


    //Width and height of map
    var width = 960;
    var height = 500;

    // D3 Projection
    var projection = d3.geoAlbersUsa()
      .translate([width / 2, height / 2]) // translate to center of screen
      .scale([1000]); // scale things down so see entire US

    // Define path generator
    var path = d3.geoPath() // path generator that will convert GeoJSON to SVG paths
      .projection(projection); // tell path generator to use albersUsa projection

    //Create SVG element and append map to the SVG
    var svg = d3.select("#svgZ")
      .append("svg")
      .attr("width", width)
      .attr("height", height);


    var color = d3.scaleThreshold()
      .domain(d3.range(2, 18))
      .range(d3.schemeYlOrRd[9]);

    var g = svg.append("g");
    //The title of the d3 map
    svg.append("text")
      .attr("x", 400)
      .attr("y", 20)
      .attr("font-family", "sans-serif")
      .style("font-size", "20px")
      .style("font-weight", "bold")
      .text("");

    svg.append("input-range")
      .attr("x", 400)
      .attr("y", 20)
      .attr("font-family", "sans-serif")
      .style("font-size", "20px")
      .style("font-weight", "bold")
      .text("");

    //function for tooltip => on map hover
    var tip = d3.tip()
      .attr('class', 'd3-tip')
      .offset([-5, 0])
      .html(function (d) {
        var dataRow = countryById.get(d.properties.name);
        if (dataRow) {
          return dataRow.states + ": " + dataRow.value;
        } else {
          return d.properties.name + ": " + d.properties.value;
        }
      })
    svg.call(tip);

    var countryById = d3.map();
    //function to bind state values
    function typeAndSet(d) {
      d.value = +d.value;
      countryById.set(d.states, d);
      return d;
    }

    //get color country
    function getColor(d) {
      var dataRow = countryById.get(d.properties.name);
      if (dataRow) {
        return ramp(dataRow.value);
      } else {
        return "#ccc";
      }
    }


    //this function is being called only when ALL CAUSES is selected as a cause for map fires
    function updateMapAllCauses(fileNumber, cause) {

      //Build the vertical legend: create the rectangles, fill with the appropriate color scale
      g.selectAll("rect")
        .data(color.range().map(function (d) {
          d = color.invertExtent(d);
          if (d[0] == null) d[0] = yLegend.domain()[0];
          if (d[1] == null) d[1] = yLegend.domain()[1];
          return d;
        }))
        .enter().append("rect")
        .attr("height", 25)
        .attr("x", -50)
        .attr("y", function (d) {
          return yLegend(d[0]) + 12;
        })
        .attr("width", 33)
        .attr("fill", function (d) { return color(d[0]); })
        .attr("col", function (d) { return d[0] })
        .on('mouseover', function input() {
          d3.selectAll("rect")
            //.remove()
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", .5)
        })
        .on('click', function (dis, i, n) {
          d3.selectAll("path").each(function (d) {
            var opcaityOnClick = 0.3
            if (d == null) {
              console.log("NK")
              console.log(" is = " + d3.select(n[i]).attr("y"))
            } else if (d["properties"]['value'] > 10000) {
            }
            if (d3.select(n[i]).attr("y") == 70 && d != null) {
              if (d["properties"]['value'] > 1000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 94 && d != null) {
              if (d["properties"]['value'] < 1000 || d["properties"]['value'] > 2000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 118 && d != null) {
              if (d["properties"]['value'] < 2000 || d["properties"]['value'] > 3000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 143 && d != null) {
              if (d["properties"]['value'] < 3000 || d["properties"]['value'] > 4000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 167 && d != null) {
              if (d["properties"]['value'] < 4000 || d["properties"]['value'] > 5000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 191 && d != null) {
              if (d["properties"]['value'] < 5000 || d["properties"]['value'] > 6000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 215 && d != null) {
              if (d["properties"]['value'] < 6000 || d["properties"]['value'] > 7000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 239 && d != null) {
              if (d["properties"]['value'] < 7000 || d["properties"]['value'] > 8000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 264 && d != null) {
              if (d["properties"]['value'] < 8000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }

          });

          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", .5)
        })
        .on('mouseout', function input() {
          d3.selectAll("path")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
        });


      //legend title
      g.append("text")
        .attr("font-family", "sans-serif")
        .attr("x", -52)
        .attr("y", 58)
        .attr("fill", "#000")
        .attr("text-anchor", "start")
        .attr("font-size", "11px")
        .attr("font-weight", "bold")
        .text("Num Fires (CLICK)");

      //Place the legend axis with the values in it
      g.append("g")
        .attr("transform", "translate(0, 0)")
        .call(d3.axisRight(yLegend)
          .tickSize(0)
          .tickFormat(function (y, i) {
            if (i > 8) return "";
            if (i == 0) return "≤ " + 1000;
            if (i == 1) return "≤ " + 2000;
            if (i == 2) return "≤ " + 3000;
            if (i == 3) return "≤ " + 4000;
            if (i == 4) return "≤ " + 5000;
            if (i == 5) return "≤ " + 6000;
            if (i == 6) return "≤ " + 7000;
            if (i == 7) return "≤ " + 8000;
            if (i == 8) return "> " + 8000;
            return y + "%";
          })
          .tickValues(color.domain()))
        .select(".domain")
        .remove()


      //Load in my states data!
      fileName = "./fires_each_state_by_year/" + fileNumber + "_fires_each_state.csv"
      svg.selectAll("path").remove();

      d3.csv(fileName, function (data) {
        var dataArray = [];
        for (var d = 0; d < data.length; d++) {
          dataArray.push(parseFloat(data[d].value))
        }
        var minVal = d3.min(dataArray)
        var maxVal = d3.max(dataArray)
        var ramp = d3.scaleSequential().domain([minVal, maxVal]).interpolator(d3.interpolateYlOrRd)

        // Load GeoJSON data and merge with states data
        d3.json("us-states.json", function (json) {

          // Loop through each state data value in the .csv file
          for (var i = 0; i < data.length; i++) {

            // Grab State Name
            var dataState = data[i].state;

            // Grab data value 
            var dataValue = data[i].value;

            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++) {
              var jsonState = json.features[j].properties.name;

              if (dataState == jsonState) {

                // Copy the data value into the JSON
                json.features[j].properties.value = dataValue;

                // Stop looking through the JSON
                break;
              }
            }
          }

          // Bind the data to the SVG and create one path per GeoJSON feature
          svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("pathState", function (d) { return d.properties.name; })
            .attr("d", path)
            .style("stroke", "#000")
            .style("stroke-width", ".3")
            .style("fill", function (d) {
              if (d.properties.value <= 1000) return color(1)
              if (d.properties.value <= 2000 && d.properties.value > 1000) return color(2)
              if (d.properties.value <= 3000 && d.properties.value > 2000) return color(3)
              if (d.properties.value <= 4000 && d.properties.value > 3000) return color(4)
              if (d.properties.value <= 5000 && d.properties.value > 4000) return color(5)
              if (d.properties.value <= 6000 && d.properties.value > 5000) return color(6)
              if (d.properties.value <= 7000 && d.properties.value > 6000) return color(7)
              if (d.properties.value <= 8000 && d.properties.value > 7000) return color(8)
              if (d.properties.value > 8000) return color(9)
              return color(8)
            })
            .attr("e", function (d) {
              if (d.properties.value <= 1000) return color(1)
              if (d.properties.value <= 2000 && d.properties.value > 1000) return color(2)
              if (d.properties.value <= 3000 && d.properties.value > 2000) return color(3)
              if (d.properties.value <= 4000 && d.properties.value > 3000) return color(4)
              if (d.properties.value <= 5000 && d.properties.value > 4000) return color(5)
              if (d.properties.value <= 6000 && d.properties.value > 5000) return color(6)
              if (d.properties.value <= 7000 && d.properties.value > 6000) return color(7)
              if (d.properties.value <= 8000 && d.properties.value > 7000) return color(8)
              if (d.properties.value > 8000) return color(9)
              return color(8)
            })
            .on('mouseover', tip.show)
            .on('mouseout', tip.hide)
            .on('click', function (dis, i, n) {

              //state name 
              stateName = (d3.select(n[i]).attr("pathState"))

              //year to display data
              year = d3.select("#nRadius").property("value")

              //update selectors values
              d3.select('#selectButtonStates').property('value', stateName);
              d3.select('#selectButtonYears').property('value', year);

              //display data about selected state & year on horizontal bar chart
              updateHorizontalBarChart(getStateAbbreviation(stateName), year)

              //update line chart
              updateLineChart(getStateAbbreviation(stateName))
              d3.select('#selectStateForLineChart').property('value', stateName);
            });

          svg.exit().remove();

          d3.selectAll('.axis').remove();
          // add a legend
          var colorScale2 = d3.scaleSequential(d3.interpolateYlOrRd)
            .domain([minVal, maxVal]);
        });
      });
    }
    
    //this function is being called only when ARSON is selected as a cause for map fires
    function updateMapArson(fileNumber, cause) {

      g.selectAll("rect")
        .data(color.range().map(function (d) {
          d = color.invertExtent(d);
          if (d[0] == null) d[0] = yLegend.domain()[0];
          if (d[1] == null) d[1] = yLegend.domain()[1];
          return d;
        }))
        .enter().append("rect")
        .attr("height", 25)
        .attr("x", -50)
        .attr("y", function (d) {
          return yLegend(d[0]) + 12;
        })
        .attr("width", 33)
        .attr("fill", function (d) { return color(d[0]); })
        .attr("col", function (d) { return d[0] })
        .on('mouseover', function input() {
          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", .5)
        })
        .on('click', function (dis, i, n) {
          d3.selectAll("path").each(function (d) {
            var opcaityOnClick = 0.3
            if (d == null) {
            } else if (d["properties"]['value'] > 10000) {
            }
            if (d3.select(n[i]).attr("y") == 70 && d != null) {
              if (d["properties"]['value'] > 100) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 94 && d != null) {
              if (d["properties"]['value'] < 100 || d["properties"]['value'] > 200) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 118 && d != null) {
              if (d["properties"]['value'] < 200 || d["properties"]['value'] > 300) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 143 && d != null) {
              if (d["properties"]['value'] < 300 || d["properties"]['value'] > 400) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 167 && d != null) {
              if (d["properties"]['value'] < 400 || d["properties"]['value'] > 800) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 191 && d != null) {
              if (d["properties"]['value'] < 800 || d["properties"]['value'] > 1000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 215 && d != null) {
              if (d["properties"]['value'] < 1000 || d["properties"]['value'] > 1200) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 239 && d != null) {
              if (d["properties"]['value'] < 1200 || d["properties"]['value'] > 1300) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 264 && d != null) {
              if (d["properties"]['value'] < 1300) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }

          });
          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", .5)
        })
        .on('mouseout', function input() {
          d3.selectAll("path")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
        });


      //legend title
      g.append("text")
        .attr("font-family", "sans-serif")
        .attr("x", -52)
        .attr("y", 58)
        .attr("fill", "#000")
        .attr("text-anchor", "start")
        .attr("font-size", "11px")
        .attr("font-weight", "bold")
        .text("Arson (CLICK)");

      //Place the legend axis with the values in it
      g.append("g")
        .attr("transform", "translate(0, 0)")
        .call(d3.axisRight(yLegend)
          .tickSize(0)
          .tickFormat(function (y, i) {
            if (i > 8) return "";
            if (i == 0) return "≤ " + "100";
            if (i == 1) return "≤ " + "200";
            if (i == 2) return "≤ " + "300";
            if (i == 3) return "≤ " + "400";
            if (i == 4) return "≤ " + "800";
            if (i == 5) return "≤ " + "1000";
            if (i == 6) return "≤ " + "1200";
            if (i == 7) return "≤ " + "1300";
            if (i == 8) return "> " + "1300";
            return y + "%";
          })
          .tickValues(color.domain()))
        .select(".domain")
        .remove()

      // Load in my states data!
      fileName = "./arson_causes_fires_each_state_by_year/arson_" + fileNumber + "_fires_each_state.csv"
      svg.selectAll("path").remove();

      d3.csv(fileName, function (data) {

        var dataArray = [];
        for (var d = 0; d < data.length; d++) {
          dataArray.push(parseFloat(data[d].value))
        }

        var minVal = d3.min(dataArray)
        var maxVal = d3.max(dataArray)
        var ramp = d3.scaleSequential().domain([minVal, maxVal]).interpolator(d3.interpolateYlOrRd)

        // Load GeoJSON data and merge with states data
        d3.json("us-states.json", function (json) {

          // Loop through each state data value in the .csv file
          for (var i = 0; i < data.length; i++) {

            // Grab State Name
            var dataState = data[i].state;

            // Grab data value 
            var dataValue = data[i].value;

            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++) {
              var jsonState = json.features[j].properties.name;

              if (dataState == jsonState) {

                // Copy the data value into the JSON
                json.features[j].properties.value = dataValue;

                // Stop looking through the JSON
                break;
              }
            }
          }

          // Bind the data to the SVG and create one path per GeoJSON feature
          svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#000")
            .style("stroke-width", ".3")
            .style("fill", function (d) {
              if (d.properties.value <= 100) return color(1)
              if (d.properties.value <= 200 && d.properties.value > 100) return color(2)
              if (d.properties.value <= 300 && d.properties.value > 200) return color(3)
              if (d.properties.value <= 400 && d.properties.value > 300) return color(4)
              if (d.properties.value <= 800 && d.properties.value > 400) return color(5)
              if (d.properties.value <= 1000 && d.properties.value > 800) return color(6)
              if (d.properties.value <= 1200 && d.properties.value > 1000) return color(7)
              if (d.properties.value <= 1300 && d.properties.value > 1200) return color(8)
              if (d.properties.value > 1300) return color(9)
              return color(8)
            })
            .attr("e", function (d) {
              if (d.properties.value <= 100) return color(1)
              if (d.properties.value <= 200 && d.properties.value > 100) return color(2)
              if (d.properties.value <= 300 && d.properties.value > 200) return color(3)
              if (d.properties.value <= 400 && d.properties.value > 300) return color(4)
              if (d.properties.value <= 800 && d.properties.value > 400) return color(5)
              if (d.properties.value <= 1000 && d.properties.value > 800) return color(6)
              if (d.properties.value <= 1200 && d.properties.value > 1000) return color(7)
              if (d.properties.value <= 1300 && d.properties.value > 1200) return color(8)
              if (d.properties.value > 1300) return color(9)
              return color(8)
            })
            .on('mouseover', tip.show)
            .on('mouseout', tip.hide)
            .on('click', function () {
            })
          svg.exit().remove();

          d3.selectAll('.axis').remove();
        });
      });

    }

    function updateMap(fileNumber, cause) {
      switch (cause) {
        case 'All causes':
          g.selectAll("rect").remove()
          g.selectAll("text").remove()
          updateMapAllCauses(fileNumber, cause)
          break;
        case 'Arson':
          g.selectAll("rect").remove()
          g.selectAll("text").remove()
          updateMapArson(fileNumber, cause)
          break;
        default:
          console.log("lsl");
      }
    }

    // create continuous color legend
    function continuous(selector_id, colorscale) {

      var legendheight = 300,
        legendwidth = 120,
        margin = { top: 50, right: 60, bottom: 20, left: 5 };

      var canvas = d3.select(selector_id)
        .style("height", legendheight + "px")
        .style("width", legendwidth + "px")
        .style("position", "absolute")
        .append("canvas")
        .attr("height", legendheight - margin.top - margin.bottom)
        .attr("width", 1)
        .style("height", (legendheight - margin.top - margin.bottom) + "px")
        .style("width", (legendwidth - margin.left - margin.right) + "px")
        .style("position", "absolute")
        .style("top", (margin.top) + "px")
        .style("left", (margin.left) + "px")
        .node();

      var ctx = canvas.getContext("2d");

      var legendscale = d3.scaleLinear()
        .range([1, legendheight - margin.top - margin.bottom])
        .domain(colorscale.domain());

      var image = ctx.createImageData(1, legendheight);
      d3.range(legendheight).forEach(function (i) {
        var c = d3.rgb(colorscale(legendscale.invert(i)));
        image.data[4 * i] = c.r;
        image.data[4 * i + 1] = c.g;
        image.data[4 * i + 2] = c.b;
        image.data[4 * i + 3] = 255;
      });
      ctx.putImageData(image, 0, 0);

      var legendaxis = d3.axisRight()
        .scale(legendscale)
        .tickSize(6)
        .ticks(10);

      var svg = d3.select(selector_id)
        .append("svg")
        .attr("height", 300)
        .attr("width", 140)
        .style("position", "absolute")
        .style("left", "0px")
        .style("top", "0px")
      svg
        .append("g")
        .attr("class", "axis")
        .attr("transform", "translate(" + (legendwidth - margin.left - margin.right + 5) + "," + (margin.top) + ")")
        .call(legendaxis);

    };


    //this function will plot the map on the initial rendering
    function initialMap() {

      //map legend
      g.selectAll("rect")
        .data(color.range().map(function (d) {
          d = color.invertExtent(d);
          if (d[0] == null) d[0] = yLegend.domain()[0];
          if (d[1] == null) d[1] = yLegend.domain()[1];
          return d;
        }))
        .enter().append("rect")
        .attr("height", 25)
        .attr("x", -50)
        .attr("y", function (d) {
          return yLegend(d[0]) + 12;
        })
        .attr("width", 33)
        .attr("fill", function (d) { return color(d[0]); })
        .attr("col", function (d) { return d[0] })
        .on('mouseover', function input() {
          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", .5)
        })
        .on('click', function (dis, i, n) {
          d3.selectAll("path").each(function (d) {
            var opcaityOnClick = 0.3
            if (d == null) {
              console.log("NK")
              console.log(" is = " + d3.select(n[i]).attr("y"))
            } else if (d["properties"]['value'] > 10000) {
            }
            if (d3.select(n[i]).attr("y") == 70 && d != null) {
              if (d["properties"]['value'] > 1000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 94 && d != null) {
              if (d["properties"]['value'] < 1000 || d["properties"]['value'] > 2000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 118 && d != null) {
              if (d["properties"]['value'] < 2000 || d["properties"]['value'] > 3000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 143 && d != null) {
              if (d["properties"]['value'] < 3000 || d["properties"]['value'] > 4000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 167 && d != null) {
              if (d["properties"]['value'] < 4000 || d["properties"]['value'] > 5000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 191 && d != null) {
              if (d["properties"]['value'] < 5000 || d["properties"]['value'] > 6000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 215 && d != null) {
              if (d["properties"]['value'] < 6000 || d["properties"]['value'] > 7000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 239 && d != null) {
              if (d["properties"]['value'] < 7000 || d["properties"]['value'] > 8000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }
            if (d3.select(n[i]).attr("y") == 264 && d != null) {
              if (d["properties"]['value'] < 8000) {
                d3.select(this).style("opacity", opcaityOnClick)
              }
            }

          });

          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", .5)
        })
        .on('mouseout', function input() {
          d3.selectAll("path")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.selectAll("rect")
            .transition()
            .duration(200)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 1)
        });


      //legend title
      g.append("text")
        .attr("font-family", "sans-serif")
        .attr("x", -52)
        .attr("y", 58)
        .attr("fill", "#000")
        .attr("text-anchor", "start")
        .attr("font-size", "11px")
        .attr("font-weight", "bold")
        .text("Num Fires (CLICK)");

      //Place the legend axis with the values in it
      g.attr("transform", "translate(55, 0)")
        .call(d3.axisRight(yLegend)
          .tickSize(0)
          .tickFormat(function (y, i) {
            if (i > 8) return "";
            if (i == 0) return "≤ " + 1000;
            if (i == 1) return "≤ " + 2000;
            if (i == 2) return "≤ " + 3000;
            if (i == 3) return "≤ " + 4000;
            if (i == 4) return "≤ " + 5000;
            if (i == 5) return "≤ " + 6000;
            if (i == 6) return "≤ " + 7000;
            if (i == 7) return "≤ " + 8000;
            if (i == 8) return "> " + 8000;
            return y + "%";
          })
          .tickValues(color.domain()))
        .select(".domain")
        .remove()

      //draw map based on csv file data
      d3.csv("./fires_each_state_by_year/1992_fires_each_state.csv", function (data) {
        var dataArray = [];
        for (var d = 0; d < data.length; d++) {
          dataArray.push(parseFloat(data[d].value))
        }
        var minVal = d3.min(dataArray)
        var maxVal = d3.max(dataArray)
        var ramp = d3.scaleSequential().domain([minVal, maxVal]).interpolator(d3.interpolateYlOrRd)

        // Load GeoJSON data and merge with states data
        d3.json("us-states.json", function (json) {

          // Loop through each state data value in the .csv file
          for (var i = 0; i < data.length; i++) {

            // Grab State Name
            var dataState = data[i].state;

            // Grab data value 
            var dataValue = data[i].value;

            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++) {
              var jsonState = json.features[j].properties.name;

              if (dataState == jsonState) {

                // Copy the data value into the JSON
                json.features[j].properties.value = dataValue;

                // Stop looking through the JSON
                break;
              }
            }
          }

          // Bind the data to the SVG and create one path per GeoJSON feature
          svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .attr("pathState", function (d) { return d.properties.name; })
            .style("stroke", "#000")
            .style("stroke-width", ".3")
            .style("fill", function (d) {
              if (d.properties.value <= 1000) return color(1)
              if (d.properties.value <= 2000 && d.properties.value > 1000) return color(2)
              if (d.properties.value <= 3000 && d.properties.value > 2000) return color(3)
              if (d.properties.value <= 4000 && d.properties.value > 3000) return color(4)
              if (d.properties.value <= 5000 && d.properties.value > 4000) return color(5)
              if (d.properties.value <= 6000 && d.properties.value > 5000) return color(6)
              if (d.properties.value <= 7000 && d.properties.value > 6000) return color(7)
              if (d.properties.value <= 8000 && d.properties.value > 7000) return color(8)
              if (d.properties.value > 8000) return color(9)
              return color(9)
            })
            .on('mouseover', tip.show)
            .on('mouseout', tip.hide)
            .on('click', function (dis, i, n) {

              //state name 
              stateName = (d3.select(n[i]).attr("pathState"))

              //year to display data
              year = d3.select("#nRadius").property("value")

              //update selectors values
              d3.select('#selectButtonStates').property('value', stateName);
              d3.select('#selectButtonYears').property('value', year);
              //console.log("State name initial = " + getStateAbbreviation(stateName))

              //display data about selected state & year on horizontal bar chart
              updateHorizontalBarChart(getStateAbbreviation(stateName), year)

              //update line chart
              updateLineChart(getStateAbbreviation(stateName))
              d3.select('#selectStateForLineChart').property('value', stateName);

            });
          // Exit
          svg.exit().remove();

          // svg.selectAll("#legend1").remove();
          d3.selectAll('.axis').remove();
        });

      });
    }

    initialMap();
  </script>
</body>

</html>
